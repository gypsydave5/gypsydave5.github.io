
<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="UTF-8">
  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true,
      },
      displayAlign: "left",
      displayIndent: "1em",
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG       : { linebreaks: { automatic: true } }
    });
</script>
<script type="text/javascript"
        async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

  <link rel="stylesheet" href="/css/style.css">
  <title>Destructuring in a Method Block</title>
</head>

  <body>
    <main>
    
<header>
  <section class="top">
    <h1>gypsydave5</h1>
    <p>The blog of David Wickes, software developer</p>
  </section>

  <ul class="links">
    <li><a href="/about/">about</a></li>
    <li><a href="/posts/">posts</a></li>
  </ul>
</header>

    
<article>
  <h1>Destructuring in a Method Block</h1>
  <time datetime="2014-07-12T18:52" >Jul 12, 2014</time>
  <p>I went from genius to idiot - very rapidly - when looking at Enumerable#map and
#inject in <a href="https://rubymonk.com/">Ruby Monk</a>, a free resource to help learn ruby that I&rsquo;ve
found really useful. Let&rsquo;s start with &lsquo;genius&rsquo; (although not really genius, more
wrong but lucky).</p>

<p>The <a href="https://rubymonk.com/learning/books/4-ruby-primer-ascent/chapters/44-collections/lessons/98-iterate-filtrate-and-transform#solution4313">question</a> was as follows:</p>

<blockquote>
<p>Exploit the fact that map always returns an array: write a method <code>hash_keys</code>
that accepts a hash and maps over it to return all the keys in a linear Array.</p>
</blockquote>

<p>Exciting, right?</p>

<p>The solution that RM gave was this:</p>

<pre><code class="language-ruby">def hash_keys(hash)
    hash.map { |pair| pair.first }
end
</code></pre>

<p>But I went for:</p>

<pre><code class="language-ruby">def hash_keys(hash)
    hash.map {|key,value| key}
end
</code></pre>

<p>Not much difference, but enough. I had become confused when I entered my code,
thinking more about the <code>each_with_index</code> method mentioned in the same page
above. I was forgetting that <code>#map</code> would be sending back a single value, an
array of the key-value pair. Ruby Monk&rsquo;s solution used that fact to use the
method <code>#first</code> on the array, to get the first element (the key) out.</p>

<p>But, by chance, my solution worked - it split the array by telling the
block for map that it would be getting two arguments - checking with the good
people on the #ruby channel on IRC (a chap called bannisterfiend to be precise),
this is <a href="http://tony.pitluga.com/2011/08/08/destructuring-with-ruby.html"><em>destructuring</em></a>, binding a set of values to
a corresponding set of values that you can normally bind to a single variable
(that&rsquo;s the definition as given in <a href="http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node252.html">Common Lisp</a>, but makes sense here).</p>

<p>What we&rsquo;re seeing is this:</p>

<pre><code class="language-ruby">x, y = [1,2]
x # =&gt; 1
y # =&gt; 2
</code></pre>

<p>But done as a loop for all the arrays pulled out of the hash by <code>#map</code>. Tony
Pitluga sings the praises of destructuring block arguments (which is what this
is) in his longer article on <a href="http://tony.pitluga.com/2011/08/08/destructuring-with-ruby.html">destructuring in Ruby</a>.</p>

<p>There&rsquo;s an improvement in the semantics of the method (would you rather have
<code>key</code> or <code>pair.first</code>?) and a saving of writing/time in any later work you might
want to do on the values. Of course, we wouldn&rsquo;t want to do this to longer
arrays - too many elements to bind to values.</p>

<p>Unless we used the &lsquo;unarray&rsquo; or, &lsquo;star&rsquo; or (best name evar) <a href="http://endofline.wordpress.com/2011/01/21/the-strange-ruby-splat/">splat
operator</a> to collect some of the other elements.</p>

<p>Consider:</p>

<pre><code class="language-ruby">x, *y = [1,2,3,4,5,6j
x # =&gt; 1
y # =&gt; [2,3,4,5,6]
</code></pre>

<p>There&rsquo;s a lot more on the magic of the splat in the second edition of <a href="http://www.manning.com/black2/">The Well
Rounded Rubyist</a> which has just been published (and which I&rsquo;m enjoying
immensely).</p>

<p>OK, I&rsquo;ll write up my other mistake (the one that broke the <code>#map</code> block) later in
the week.</p>

<p>PS - noticed when getting links for this post that Ruby 2.0 introduces the
double-splat operator for <a href="http://stackoverflow.com/questions/18289152/what-does-double-splat-operators-do-in-ruby">turning keyword-value pairs in argument lists into
a hash</a>. Which is also exciting.</p>

</article>

    </main>
  </body>
</html>
