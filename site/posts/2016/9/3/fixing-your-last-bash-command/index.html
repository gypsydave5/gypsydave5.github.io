
<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="UTF-8">
  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true,
      },
      displayAlign: "left",
      displayIndent: "1em",
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG       : { linebreaks: { automatic: true } }
    });
</script>
<script type="text/javascript"
        async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

  <link rel="stylesheet" href="/css/style.css">
  <title>Fixing your last bash command</title>
</head>

  <body>
    <main>
    
<header>
  <section class="top">
    <h1>gypsydave5</h1>
    <p>The blog of David Wickes, software developer</p>
  </section>

  <ul class="links">
    <li><a href="/about/">about</a></li>
    <li><a href="/posts/">posts</a></li>
  </ul>
</header>

    
<article>
  <h1>Fixing your last bash command</h1>
  <time datetime="2016-09-03T19:49" >Sep 03, 2016</time>
  <p>Guy I know -  Oliver - command line <em>ninja</em>. Never makes a mistake. Can
configure an AWS in a single long bash command. Typing speed through the roof.
Bet you know someone like that too.</p>

<p>We mere mortals make mistakes and, while it&rsquo;s always good to learn from your
mistakes, the first thing you have to do is <em>fix them</em>.</p>

<p>And to fix them you need to learn how to fix them.</p>

<h2>Simple replace</h2>

<p>Say you&rsquo;ve typed an impossibly long command into the terminal with one
irritating mistake. For me, it&rsquo;s usually something to do with <code>xargs</code> or <code>curl</code></p>

<pre><code class="language-bash">  curl -s -I -X POST https://en.wikipedia.org/wiki/CURL | grep HTTP | cut -d ' ' -f 2
</code></pre>

<p>Not the greatest command - but say I couldn&rsquo;t spell wikipedia&hellip;</p>

<pre><code class="language-bash">  curl -s -I -X POST https://en.wikpedia.org/wiki/CURL | grep HTTP | cut -d ' ' -f 2
</code></pre>

<h3>First solution: up and left</h3>

<p>Naive, and effective. Press up to show the last command, keep tapping left until
you get the the bit of the command you need to change, backspace to remove what
you don&rsquo;t need and then enter what you do need</p>

<h3>Second solution: bash vi mode</h3>

<p>Bash has a vi mode, which can be activated by adding the following to your
<code>.bashrc</code>.</p>

<pre><code class="language-bash">set -o vi
</code></pre>

<p>If you&rsquo;re comfortable with vi you can now hit <code>Escape</code> to bounce into normal
mode, <code>Ctrl-P</code> to go back to the last command, <code>b</code> a few times to get to the
word you need to change&hellip; etc.</p>

<p>Vi mode is great - if you know a bit of vi. But you might not. So&hellip;</p>

<h3>Third solution: quick substitution</h3>

<p>How about something a little smarter:</p>

<pre><code class="language-bash">^wikpedia^wikipedia
</code></pre>

<p>This is the bash <a href="https://www.gnu.org/software/bash/manual/html_node/Event-Designators.html#Event-Designators">quick substitution</a> history expansion command - it
runs the last command, substituting the first instance of the charaters after
the first caret with the characters after the second caret.</p>

<p>Pretty neat huh? But that will olny work for the first instance - what if we
need to replace every instance of <code>wikpedia</code> in the last command?</p>

<h3>Fourth solution: full history substituton</h3>

<p>Bash uses the <code>!</code> character as the <a href="https://www.gnu.org/software/bash/manual/html_node/History-Interaction.html#History-Interaction">history expansion</a> character - it
is used to substitute a part of your current command with a previously executed
command<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>. One <code>!</code> does nothing - but the previous command can be accessed with
the <code>!!</code> sequence. So, to print out the last command, try:</p>

<pre><code class="language-bash">echo !!
</code></pre>

<p>These history expansions can also take <a href="https://www.gnu.org/software/bash/manual/html_node/Modifiers.html#Modifiers">modifier</a> options to change the string
before it gets inserted. The syntax is <code>&lt;select&gt;:&lt;modifier&gt;</code>. For instance, to
put the last command in quotes:</p>

<pre><code class="language-bash">echo !!:q
</code></pre>

<p>And to perform a global substitution on it:</p>

<pre><code class="language-bash">echo !!:gs/wikpedia/wikipedia
</code></pre>

<p>There is lots that can be done with the above syntax - just take a look at the
documentation.</p>

<h3>Fifth solution: retype the command</h3>

<p>Seriously, by the time you&rsquo;ve remembered how to do some of the above, wouldn&rsquo;t
it have just been easier to type it out again.</p>

<p>Just don&rsquo;t mess it up this time, right?</p>

<div class="footnotes">

<hr />

<ol>
<li id="fn:1">And this is the reason I have to escape <code>!</code> whenever I use it in commit messages</li>
</ol>

</div>

</article>

    </main>
  </body>
</html>
